<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>springmvc组件之HandlerMapping | lfh&#39;s bokes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="用了很多关于Controller，最近一次面试被问SpringMvc的组件有哪些，有点懵逼？ HandlerMapping其作用是：通过getHandler来获取请求的Handler和Interceptors。它在DispatcherServlet.initHandlerMappings(context)中被初始化。默认使用为：BeanNameUrlHandlerMapping和DefaultAn">
<meta property="og:type" content="article">
<meta property="og:title" content="springmvc组件之HandlerMapping">
<meta property="og:url" content="https://linfordhu.github.io/lfhboke.github.io/2017/04/30/springmvc组件之HandlerMapping/index.html">
<meta property="og:site_name" content="lfh&#39;s bokes">
<meta property="og:description" content="用了很多关于Controller，最近一次面试被问SpringMvc的组件有哪些，有点懵逼？ HandlerMapping其作用是：通过getHandler来获取请求的Handler和Interceptors。它在DispatcherServlet.initHandlerMappings(context)中被初始化。默认使用为：BeanNameUrlHandlerMapping和DefaultAn">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://linfordhu.github.io/lfhboke.github.io/css/images/handlermapping.png">
<meta property="og:updated_time" content="2017-04-30T16:55:51.755Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="springmvc组件之HandlerMapping">
<meta name="twitter:description" content="用了很多关于Controller，最近一次面试被问SpringMvc的组件有哪些，有点懵逼？ HandlerMapping其作用是：通过getHandler来获取请求的Handler和Interceptors。它在DispatcherServlet.initHandlerMappings(context)中被初始化。默认使用为：BeanNameUrlHandlerMapping和DefaultAn">
<meta name="twitter:image" content="https://linfordhu.github.io/lfhboke.github.io/css/images/handlermapping.png">
  
    <link rel="alternate" href="/lfhboke.github.io/atom.xml" title="lfh&#39;s bokes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/lfhboke.github.io/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/lfhboke.github.io/" id="logo">lfh&#39;s bokes</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/lfhboke.github.io/">Home</a>
        
          <a class="main-nav-link" href="/lfhboke.github.io/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/lfhboke.github.io/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://linfordhu.github.io/lfhboke.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-springmvc组件之HandlerMapping" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/lfhboke.github.io/2017/04/30/springmvc组件之HandlerMapping/" class="article-date">
  <time datetime="2017-04-30T10:16:23.000Z" itemprop="datePublished">2017-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      springmvc组件之HandlerMapping
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用了很多关于Controller，最近一次面试被问SpringMvc的组件有哪些，有点懵逼？</p>
<h3 id="HandlerMapping"><a href="#HandlerMapping" class="headerlink" title="HandlerMapping"></a>HandlerMapping</h3><p>其作用是：通过getHandler来获取请求的Handler和Interceptors。它在DispatcherServlet.initHandlerMappings(context)中被初始化。默认使用为：<font color="red">BeanNameUrlHandlerMapping和DefaultAnnotationHandlerMapping。</font></p>
<h4 id="HandlerMapping类图"><a href="#HandlerMapping类图" class="headerlink" title="HandlerMapping类图"></a>HandlerMapping类图</h4><p><img src="/lfhboke.github.io/css/images/handlermapping.png" alt="HandlerMapping类图"><br>HandlerMapping所有的实现类都继承了一个共有的抽象类AbstractHandlerMapping，它所有的子类中分类如下几只：</p>
<ol>
<li><font color="red">EmptyHandlerMapping:</font>空处理，直接返回空</li>
<li><font color="red">AbstractHandlerMethodMapping：</font>通过method处理</li>
<li><font color="red">AbstractUrlHandlerMapping:</font>通过url处理<h4 id="AbstractHandlerMapping"><a href="#AbstractHandlerMapping" class="headerlink" title="AbstractHandlerMapping"></a>AbstractHandlerMapping</h4>AbstractHandlerMapping是HandlerMapping的抽象实现，所有的HandlerMapping的实现类都继承自AbstractHandlerMapping。AbstractHandlerMapping采用模板模式设计了HandlerMapping实现的整体架构，子类只需要通过模板方法提供一些初始值或具体的算法即可。</li>
</ol>
<p>HandlerMapping的作用是根据request找到Handler和Interceptors。</p>
<ol>
<li>获取Handler的过程通过模板方法getHandlerInternal交给了子类。</li>
<li>Abstract Handler Mapping保存了所用配置的Inteceptor，在获取Handler后自己根据从request提取的lookupPath将相应的Interceptors装配上去，当然子类也可以通过getHandlerInternal设置自己的Interceptor。<h4 id="创建AbstractHandlerMapping"><a href="#创建AbstractHandlerMapping" class="headerlink" title="创建AbstractHandlerMapping"></a>创建AbstractHandlerMapping</h4>AbstractHandlerMapping继承了webApplicationObjectSupport，初始化时会自动调用模板方法initApplicationContext，AbstractHandlerMapping的创建就是在initApplicationContext()方法里实现的。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractHandlerMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractHandlerMapping</span> <span class="keyword">extends</span> <span class="title">WebApplicationObjectSupport</span></span></span><br><span class="line"><span class="class">		<span class="keyword">implements</span> <span class="title">HandlerMapping</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 用于配置SpringMVC的拦截器，有两种方式配置：</span></span><br><span class="line"><span class="comment">		 * - 注册HandlerMapping时通过属性设置。</span></span><br><span class="line"><span class="comment">		 * - 通过子类的extendInterceptors模板方法设置。</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * interceptors并不会直接使用，而是通过initInterceptors()分配到mappedInterceptors 或者 adaptedInterceptors中进行使用。</span></span><br><span class="line"><span class="comment">		**/</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> List&lt;Object&gt; interceptors = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局拦截器：无需匹配url</span></span><br><span class="line">    	<span class="keyword">private</span> <span class="keyword">final</span> List&lt;HandlerInterceptor&gt; adaptedInterceptors = <span class="keyword">new</span> ArrayList&lt;HandlerInterceptor&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//path拦截器: 通过匹配url拦截</span></span><br><span class="line">    	<span class="keyword">private</span> <span class="keyword">final</span> List&lt;MappedInterceptor&gt; mappedInterceptors = <span class="keyword">new</span> ArrayList&lt;MappedInterceptor&gt;();</span><br><span class="line">    	</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">    	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initApplicationContext</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    	    <span class="comment">//模板方法，供子类实现： 用于给子类提供一个添加(修改)interceptors的入口，现有SpringMVC 没有实现。</span></span><br><span class="line">    		extendInterceptors(<span class="keyword">this</span>.interceptors);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//初始化mappedInterceptors</span></span><br><span class="line">    		detectMappedInterceptors(<span class="keyword">this</span>.mappedInterceptors);</span><br><span class="line">			</span><br><span class="line">		<span class="comment">//初始化Interceptor:  分配interceptors </span></span><br><span class="line">    		initInterceptors();</span><br><span class="line">    	&#125;</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">//将SpringMVC容器以及父容器中所有的MappedInterceptor类型的Bean添加到mappedInterceptors</span></span><br><span class="line">    	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">detectMappedInterceptors</span><span class="params">(List&lt;MappedInterceptor&gt; mappedInterceptors)</span> </span>&#123;</span><br><span class="line">            mappedInterceptors.addAll(</span><br><span class="line">                    BeanFactoryUtils.beansOfTypeIncludingAncestors(</span><br><span class="line">                            getApplicationContext(),MappedInterceptor.class, <span class="keyword">true</span>, <span class="keyword">false</span>).values());</span><br><span class="line">        &#125;	</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//将interceptors中各对象类型添加至 mappedInterceptors 或者 adaptedInterceptors</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initInterceptors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.interceptors.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.interceptors.size(); i++) &#123;</span><br><span class="line">                    Object interceptor = <span class="keyword">this</span>.interceptors.get(i);</span><br><span class="line">                    <span class="keyword">if</span> (interceptor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Entry number "</span> + i + <span class="string">" in interceptors array is null"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (interceptor <span class="keyword">instanceof</span> MappedInterceptor) &#123;</span><br><span class="line">                        mappedInterceptors.add((MappedInterceptor) interceptor);</span><br><span class="line">                    &#125;    <span class="keyword">else</span> &#123;</span><br><span class="line">                        adaptedInterceptors.add(adaptInterceptor(interceptor));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="AbstractHandlerMapping作用"><a href="#AbstractHandlerMapping作用" class="headerlink" title="AbstractHandlerMapping作用"></a>AbstractHandlerMapping作用</h4><p>HandlerMapping是通过getHandler来获取请求的Handler和Interceptors。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractHandlerMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">//模板方法，由子类实现</span></span><br><span class="line">    Object handler = getHandlerInternal(request);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        handler = getDefaultHandler();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Bean name or resolved handler?</span></span><br><span class="line">    <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        String handlerName = (String) handler;</span><br><span class="line">        handler = getApplicationContext().getBean(handlerName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getHandlerExecutionChain(handler, request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>getHandler方法的实现分为两部分：找Handler和getHandlerExecutionChain添加拦截器。</p>
<p>找Handler的过程：</p>
<ol>
<li>通过getHandlerInternal()模板方法获取，此方法由子类实现。</li>
<li>如果没有获取到则使用默认的Handler，可以在配置HandlerMapping时通过defaultHandler属性配置。</li>
<li>如果找到的Handler是String类型，则从SpringMVC容器里找到该名称的Bean。</li>
</ol>
<p>getHandlerExecutionChain<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandlerExecutionChain</span><span class="params">(Object handler, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    HandlerExecutionChain chain = </span><br><span class="line">        (handler <span class="keyword">instanceof</span> HandlerExecutionChain) ?</span><br><span class="line">            (HandlerExecutionChain) handler : <span class="keyword">new</span> HandlerExecutionChain(handler);</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//添加全局inteceptors        </span></span><br><span class="line">    chain.addInterceptors(getAdaptedInterceptors());</span><br><span class="line">    </span><br><span class="line">    String lookupPath = urlPathHelper.getLookupPathForRequest(request);</span><br><span class="line">    <span class="keyword">for</span> (MappedInterceptor mappedInterceptor : mappedInterceptors) &#123;</span><br><span class="line">         <span class="comment">//根据url 匹配寻找 MappedInterceptor</span></span><br><span class="line">        <span class="keyword">if</span> (mappedInterceptor.matches(lookupPath, pathMatcher)) &#123;</span><br><span class="line">            chain.addInterceptor(mappedInterceptor.getInterceptor());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> chain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>getHandlerExecutionChain方法比较简单：首先是使用handler创建HandlerExecutionChain，然后将adaptedInterceptors和request匹配的mappedInterceptors添加进去即可。</p>
<h4 id="AbstractUrlHandlerMapping系列"><a href="#AbstractUrlHandlerMapping系列" class="headerlink" title="AbstractUrlHandlerMapping系列"></a>AbstractUrlHandlerMapping系列</h4><font color="red">AbstractUrlHandlerMapping</font>从名称就可以看出它是通过url来进行匹配的。它工作的大致原理：将url与对应的Handler保存在一个Map中，在它的getHandlerInternal方法中，使用url从Map中获取Handler。<br>1. AbstractUrlHandlerMapping实现了根据url从Map获取Handler的逻辑，Map的初始化工作则交给了子孙类中实现。<br>2. AbstractUrlHandlerMapping还定义了”/“请求处理器rootHandler<br><br>Handler方法的入口是<font color="red">getHandlerInternal</font>，通过这个方法，查看下Map是如何初始化的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractUrlHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractHandlerMapping</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object rootHandler;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; handlerMap = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</span><br><span class="line">    </span><br><span class="line">   	<span class="meta">@Override</span></span><br><span class="line">   	<span class="function"><span class="keyword">protected</span> Object <span class="title">getHandlerInternal</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   	    <span class="comment">//获取request的请求url</span></span><br><span class="line">   		String lookupPath = getUrlPathHelper().getLookupPathForRequest(request);</span><br><span class="line">   		</span><br><span class="line">   		<span class="comment">//注1. 从Map中查找匹配的Handler</span></span><br><span class="line">   		Object handler = lookupHandler(lookupPath, request);</span><br><span class="line">   		<span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">   			Object rawHandler = <span class="keyword">null</span>;</span><br><span class="line">   			<span class="keyword">if</span> (<span class="string">"/"</span>.equals(lookupPath)) &#123;</span><br><span class="line">   				rawHandler = getRootHandler();</span><br><span class="line">   			&#125;</span><br><span class="line">   			<span class="keyword">if</span> (rawHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">   				rawHandler = getDefaultHandler();</span><br><span class="line">   			&#125;</span><br><span class="line">   			<span class="keyword">if</span> (rawHandler != <span class="keyword">null</span>) &#123;</span><br><span class="line">   				<span class="comment">// 如果handler是String,则到容器找到对应的bean.</span></span><br><span class="line">   				<span class="keyword">if</span> (rawHandler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">   					String handlerName = (String) rawHandler;</span><br><span class="line">   					rawHandler = getApplicationContext().getBean(handlerName);</span><br><span class="line">   				&#125;</span><br><span class="line">   				</span><br><span class="line">   				<span class="comment">//校验handler与request是否匹配，模板方法由子类实现。（已知的子类中都没有实现）</span></span><br><span class="line">   				validateHandler(rawHandler, request);</span><br><span class="line">   				</span><br><span class="line">   				<span class="comment">//注2. </span></span><br><span class="line">   				handler = buildPathExposingHandler(rawHandler, lookupPath, lookupPath, <span class="keyword">null</span>);</span><br><span class="line">   			&#125;</span><br><span class="line">   		&#125;</span><br><span class="line">   	       </span><br><span class="line">   	     <span class="comment">//log 略.....</span></span><br><span class="line">   		<span class="keyword">return</span> handler;</span><br><span class="line">   	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>lookupHandler<br><font color="red">lookupHandler</font>方法用于使用lookupPath从Map中找到匹配的Handler，不过很多时候并不能直接从Map中get到，因为很多Handler都用了Pattern模式，如<font color="red">“/user/*”</font>。<br>1. 无法直接从Map中get到对应的Handler<br>2. 同一个url可能会匹配到多个Handler<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">lookupHandler</span><span class="params">(String urlPath, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 从map中获取,判断是否直接全字匹配。</span></span><br><span class="line">		Object handler = <span class="keyword">this</span>.handlerMap.get(urlPath);</span><br><span class="line">		<span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 如果为String,则从容器中获取bean</span></span><br><span class="line">			<span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">				String handlerName = (String) handler;</span><br><span class="line">				handler = getApplicationContext().getBean(handlerName);</span><br><span class="line">			&#125;</span><br><span class="line">			validateHandler(handler, request);</span><br><span class="line">			<span class="keyword">return</span> buildPathExposingHandler(handler, urlPath, urlPath, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Pattern 匹配</span></span><br><span class="line">		List&lt;String&gt; matchingPatterns = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		<span class="keyword">for</span> (String registeredPattern : <span class="keyword">this</span>.handlerMap.keySet()) &#123;</span><br><span class="line">			<span class="keyword">if</span> (getPathMatcher().match(registeredPattern, urlPath)) &#123;</span><br><span class="line">			    <span class="comment">//记录匹配到的 patterns</span></span><br><span class="line">				matchingPatterns.add(registeredPattern);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		String bestPatternMatch = <span class="keyword">null</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//自定义Comparator ,按照规则对匹配到的patterns进行匹配：： Comparatorg根据 *，以及&#123; 个数来判断优先级.</span></span><br><span class="line">		Comparator&lt;String&gt; patternComparator = getPathMatcher().getPatternComparator(urlPath);</span><br><span class="line">		<span class="keyword">if</span> (!matchingPatterns.isEmpty()) &#123;</span><br><span class="line">			Collections.sort(matchingPatterns, patternComparator);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//获取bestPatternMatch</span></span><br><span class="line">			bestPatternMatch = matchingPatterns.get(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (bestPatternMatch != <span class="keyword">null</span>) &#123;</span><br><span class="line">			handler = <span class="keyword">this</span>.handlerMap.get(bestPatternMatch);</span><br><span class="line">			<span class="comment">// 如果为String,则从容器中获取bean</span></span><br><span class="line">			<span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">				String handlerName = (String) handler;</span><br><span class="line">				handler = getApplicationContext().getBean(handlerName);</span><br><span class="line">			&#125;</span><br><span class="line">			validateHandler(handler, request);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * 获取pattern通配符即* 匹配的部分</span></span><br><span class="line"><span class="comment">			 * matcher.extractPathWithinPattern("/*/</span>*<span class="string">", "</span>/user/add<span class="string">");  //结果： user/add</span></span><br><span class="line"><span class="string">			 * matcher.extractPathWithinPattern("</span>/user<span class="comment">/*", "/user/add");  //结果： add</span></span><br><span class="line"><span class="comment">			 * matcher.extractPathWithinPattern("/*/</span>add<span class="string">", "</span>/user/add<span class="string">");  //结果： user</span></span><br><span class="line"><span class="string">			 */</span></span><br><span class="line"><span class="string">			String pathWithinMapping = getPathMatcher().extractPathWithinPattern(bestPatternMatch, urlPath);</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">			//matchingPatterns中可能有多个 同 bestPatternMatch 优先级相同的 patterns, 将所有同级别的pattern记录</span></span><br><span class="line"><span class="string">			Map&lt;String, String&gt; uriTemplateVariables = new LinkedHashMap&lt;String, String&gt;();</span></span><br><span class="line"><span class="string">			for (String matchingPattern : matchingPatterns) &#123;</span></span><br><span class="line"><span class="string">			    //通过compare ==0 ，说明matchingPattern与bestPatternMatch 优先级相同</span></span><br><span class="line"><span class="string">				if (patternComparator.compare(bestPatternMatch, matchingPattern) == 0) &#123;</span></span><br><span class="line"><span class="string">				    /**</span></span><br><span class="line"><span class="string">				     * getPathMatcher().extractUriTemplateVariables(matchingPattern, urlPath)伪码表示：</span></span><br><span class="line"><span class="string">				     *  判断urlPath与matchingPattern是否匹配，</span></span><br><span class="line"><span class="string">				     *  如果匹配：则返回一个LinkedHashMap&lt;String, String&gt;().of(urlPath,matchingPattern);</span></span><br><span class="line"><span class="string">				     *  否则：返回一个 LinkedHashMap.empty();</span></span><br><span class="line"><span class="string">				     */</span></span><br><span class="line"><span class="string">					uriTemplateVariables.putAll(getPathMatcher().extractUriTemplateVariables(matchingPattern, urlPath));</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">			return buildPathExposingHandler(handler, bestPatternMatch, pathWithinMapping, uriTemplateVariables);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		// No handler found...</span></span><br><span class="line"><span class="string">		return null;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br></pre></td></tr></table></figure><br><br>buildPathExposingHandler<br><br><font color="red">buildPathExposingHandler</font>方法用于给查找到的handler注册两个内部拦截器<font color="red">PathExposingHandlerInterceptor和UriTemplateVariablesHandlerInterceptor</font>，主要的作用是将与当前url实际匹配的pattern、匹配条件和url等参数设置到request的属性里，这样在后续的处理过程中就可以从request属性中获取，无需再查找一遍。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractUrlHandlerMapping $ PathExposingHandlerInterceptor</span></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">PathExposingHandlerInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String bestMatchingPattern;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String pathWithinMapping;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PathExposingHandlerInterceptor</span><span class="params">(String bestMatchingPattern, String pathWithinMapping)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bestMatchingPattern = bestMatchingPattern;</span><br><span class="line">		<span class="keyword">this</span>.pathWithinMapping = pathWithinMapping;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> </span>&#123;</span><br><span class="line">		exposePathWithinMapping(<span class="keyword">this</span>.bestMatchingPattern, <span class="keyword">this</span>.pathWithinMapping, request);</span><br><span class="line">		request.setAttribute(HandlerMapping.INTROSPECT_TYPE_LEVEL_MAPPING, supportsTypeLevelMappings());</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>Map初始化<br><br>Map的初始化工作是由<font color="red">registerHandler</font>方法进行的，与之前不同的是，该方法是由子类调用的。该方法代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerHandler</span><span class="params">(String[] urlPaths, String beanName)</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String urlPath : urlPaths) &#123;</span><br><span class="line">        registerHandler(urlPath, beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerHandler</span><span class="params">(String urlPath, Object handler)</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">		Object resolvedHandler = handler;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果没有设置lazyInitHandlers ，且handler是string</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>.lazyInitHandlers &amp;&amp; handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">			String handlerName = (String) handler;</span><br><span class="line">			<span class="keyword">if</span> (getApplicationContext().isSingleton(handlerName)) &#123;</span><br><span class="line">				resolvedHandler = getApplicationContext().getBean(handlerName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Object mappedHandler = <span class="keyword">this</span>.handlerMap.get(urlPath);</span><br><span class="line">		<span class="keyword">if</span> (mappedHandler != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mappedHandler != resolvedHandler) &#123;</span><br><span class="line">			<span class="comment">// 抛出异常，同一url 全路径完整匹配到多个Handler...</span></span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">						<span class="string">"Cannot map "</span> + getHandlerDescription(handler) + <span class="string">" to URL path ["</span> + urlPath +</span><br><span class="line">						<span class="string">"]: There is already "</span> + getHandlerDescription(mappedHandler) + <span class="string">" mapped."</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (urlPath.equals(<span class="string">"/"</span>)) &#123;</span><br><span class="line">			    <span class="comment">//设置rootHandler</span></span><br><span class="line">				setRootHandler(resolvedHandler);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (urlPath.equals(<span class="string">"/*"</span>)) &#123;</span><br><span class="line">			 <span class="comment">//设置defaultHandler</span></span><br><span class="line">				setDefaultHandler(resolvedHandler);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">			    <span class="comment">//添加url : handler 至 Map</span></span><br><span class="line">				<span class="keyword">this</span>.handlerMap.put(urlPath, resolvedHandler);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><br><br>AbstractUrlHandlerMapping定义了整体架构，子类只需要将Map初始化就可以了。<br>#### SimpleUrlHandlerMapping<br><font color="red">SimpleUrlHandlerMapping</font>通过重写<font color="red">initApplicationContext</font>方法来注册Handler，它的代码非常简单，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.SimpleUrlHandlerMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleUrlHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractUrlHandlerMapping</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; urlMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//提供设置urlMap接口</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMappings</span><span class="params">(Properties mappings)</span> </span>&#123;</span><br><span class="line">        CollectionUtils.mergePropertiesIntoMap(mappings, <span class="keyword">this</span>.urlMap);</span><br><span class="line">    &#125;</span><br><span class="line">    	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initApplicationContext</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.initApplicationContext();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//调用registerHandlers</span></span><br><span class="line">        registerHandlers(<span class="keyword">this</span>.urlMap);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerHandlers</span><span class="params">(Map&lt;String, Object&gt; urlMap)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( !urlMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : urlMap.entrySet()) &#123;</span><br><span class="line">                String url = entry.getKey();</span><br><span class="line">                Object handler = entry.getValue();</span><br><span class="line">                <span class="comment">// url以"/"起始..</span></span><br><span class="line">                <span class="keyword">if</span> (!url.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                    url = <span class="string">"/"</span> + url;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// trim</span></span><br><span class="line">                <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                    handler = ((String) handler).trim();</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//调用父类方法registerHandler</span></span><br><span class="line">                registerHandler(url, handler);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>#### AbstractDetectingUrlHandlerMapping<br><font color="red">AbstractDetectingUrlHandlerMapping</font>也是通过重写<font color="red">initApplicationContext</font>方法来注册Handler的，在方法中调用了detectHandlers，它的逻辑比较简单，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.AbstractDetectingUrlHandlerMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDetectingUrlHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractUrlHandlerMapping</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//标识是否从SpringMVC及其父容器查找Handler</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> detectHandlersInAncestorContexts = <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initApplicationContext</span><span class="params">()</span> <span class="keyword">throws</span> ApplicationContextException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.initApplicationContext();</span><br><span class="line">		detectHandlers();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">detectHandlers</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="comment">//detectHandlersInAncestorContexts为ture,从springMVC以及其祖先上下文寻找bean,否则仅从SpringMVC容器中寻找</span></span><br><span class="line">		String[] beanNames = (<span class="keyword">this</span>.detectHandlersInAncestorContexts ?</span><br><span class="line">				BeanFactoryUtils.beanNamesForTypeIncludingAncestors(getApplicationContext(), Object.class) :</span><br><span class="line">				getApplicationContext().getBeanNamesForType(Object.class));</span><br><span class="line"></span><br><span class="line">		<span class="comment">//对每个bean 如果能解析出url,就注册到父类的map中。</span></span><br><span class="line">		<span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">		    <span class="comment">//determineUrlsForHandler 模板方法，由子类实现。</span></span><br><span class="line">			String[] urls = determineUrlsForHandler(beanName);</span><br><span class="line">			<span class="keyword">if</span> (!ObjectUtils.isEmpty(urls)) &#123;</span><br><span class="line">				<span class="comment">//注册到父类Map中</span></span><br><span class="line">				registerHandler(urls, beanName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>AbstractDetectingUrlHandlerMapping有三个子类：<br>1. DefaultAnnotationHandlerMapping<br>2. BeanNameUrlHandlerMapping<br>3. AbstractControllerUrlHandlerMapping<br><br>DefaultAnnotationHandlerMapping<br><br>通过过判断类以及方法是否存在RequestMapping.class注解，来寻找urls：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultAnnotationHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractDetectingUrlHandlerMapping</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> String[] determineUrlsForHandler(String beanName) &#123;</span><br><span class="line">    		ApplicationContext context = getApplicationContext();</span><br><span class="line">    		Class&lt;?&gt; handlerType = context.getType(beanName);</span><br><span class="line">    		 <span class="comment">//寻找 @RequestMapping bean...</span></span><br><span class="line">    		RequestMapping mapping = context.findAnnotationOnBean(beanName, RequestMapping.class);</span><br><span class="line">    		<span class="keyword">if</span> (mapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">    			<span class="comment">//type即类级别的注解</span></span><br><span class="line">    			<span class="keyword">this</span>.cachedMappings.put(handlerType, mapping);</span><br><span class="line">    			Set&lt;String&gt; urls = <span class="keyword">new</span> LinkedHashSet&lt;String&gt;();</span><br><span class="line">    			String[] typeLevelPatterns = mapping.value();</span><br><span class="line">    			<span class="keyword">if</span> (typeLevelPatterns.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    				<span class="comment">//方法级别的注解</span></span><br><span class="line">    				String[] methodLevelPatterns = determineUrlsForHandlerMethods(handlerType, <span class="keyword">true</span>);</span><br><span class="line">    				<span class="keyword">for</span> (String typeLevelPattern : typeLevelPatterns) &#123;</span><br><span class="line">    					<span class="keyword">if</span> (!typeLevelPattern.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">    						typeLevelPattern = <span class="string">"/"</span> + typeLevelPattern;</span><br><span class="line">    					&#125;</span><br><span class="line">    					<span class="comment">//存在为空的Method-Mapping</span></span><br><span class="line">    					<span class="keyword">boolean</span> hasEmptyMethodLevelMappings = <span class="keyword">false</span>;</span><br><span class="line">    					<span class="keyword">for</span> (String methodLevelPattern : methodLevelPatterns) &#123;</span><br><span class="line">    						<span class="keyword">if</span> (methodLevelPattern == <span class="keyword">null</span>) &#123;</span><br><span class="line">    							hasEmptyMethodLevelMappings = <span class="keyword">true</span>;</span><br><span class="line">    						&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    						    <span class="comment">//将 类级别url + 方法级别url 拼接</span></span><br><span class="line">                                String combinedPattern = getPathMatcher().combine(typeLevelPattern, methodLevelPattern);</span><br><span class="line">                                addUrlsForPath(urls, combinedPattern);</span><br><span class="line">                            &#125;</span><br><span class="line">    					&#125;</span><br><span class="line">    					</span><br><span class="line">    					<span class="comment">/**</span></span><br><span class="line"><span class="comment">    					 * 如果<span class="doctag">@RequestMapping</span>.value == null的 方法 或者 是Controller子类(controller接口定义如下：)</span></span><br><span class="line"><span class="comment">    					 public interface Controller &#123;</span></span><br><span class="line"><span class="comment">                          	ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception;</span></span><br><span class="line"><span class="comment">                          &#125;</span></span><br><span class="line"><span class="comment">                          </span></span><br><span class="line"><span class="comment">                         * 将 类级别url 添加urls中</span></span><br><span class="line"><span class="comment">    					 */</span></span><br><span class="line">    					<span class="keyword">if</span> (hasEmptyMethodLevelMappings || org.springframework.web.servlet.mvc.Controller.class.isAssignableFrom(handlerType)) &#123;</span><br><span class="line">    						addUrlsForPath(urls, typeLevelPattern);</span><br><span class="line">    					&#125;</span><br><span class="line">    				&#125;</span><br><span class="line">    				<span class="keyword">return</span> StringUtils.toStringArray(urls);</span><br><span class="line">    			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//直接寻找 @RequestMapping 方法</span></span><br><span class="line">                    <span class="keyword">return</span> determineUrlsForHandlerMethods(handlerType, <span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">    			</span><br><span class="line">    		&#125;<span class="comment">//存在@Controller注解，但是Controller没有设置@RequestMapping</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (AnnotationUtils.findAnnotation(handlerType, Controller.class) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//直接寻找Controller内定义的方法</span></span><br><span class="line">                <span class="keyword">return</span> determineUrlsForHandlerMethods(handlerType, <span class="keyword">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">             &#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    	</span><br><span class="line">    <span class="keyword">protected</span> String[] determineUrlsForHandlerMethods(Class&lt;?&gt; handlerType, <span class="keyword">final</span> <span class="keyword">boolean</span> hasTypeLevelMapping) &#123;</span><br><span class="line">            <span class="comment">//获取自类的url结果，此处返回为空</span></span><br><span class="line">    		String[] subclassResult = determineUrlsForHandlerMethods(handlerType);</span><br><span class="line">    		<span class="keyword">if</span> (subclassResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">    			<span class="keyword">return</span> subclassResult;</span><br><span class="line">    		&#125;</span><br><span class="line">    </span><br><span class="line">    		<span class="keyword">final</span> Set&lt;String&gt; urls = <span class="keyword">new</span> LinkedHashSet&lt;String&gt;();</span><br><span class="line">    		Set&lt;Class&lt;?&gt;&gt; handlerTypes = <span class="keyword">new</span> LinkedHashSet&lt;Class&lt;?&gt;&gt;();</span><br><span class="line">    		handlerTypes.add(handlerType);</span><br><span class="line">    		handlerTypes.addAll(Arrays.asList(handlerType.getInterfaces()));</span><br><span class="line">    		</span><br><span class="line">    		<span class="comment">//遍历类 +以及该类 所有的接口 中所有方法存在@RequestMapping的方法。</span></span><br><span class="line">    		<span class="keyword">for</span> (Class&lt;?&gt; currentHandlerType : handlerTypes) &#123;</span><br><span class="line">    			ReflectionUtils.doWithMethods(currentHandlerType, <span class="keyword">new</span> ReflectionUtils.MethodCallback() &#123;</span><br><span class="line">    				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doWith</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">    					RequestMapping mapping = AnnotationUtils.findAnnotation(method, RequestMapping.class);</span><br><span class="line">    					<span class="keyword">if</span> (mapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">    						String[] mappedPatterns = mapping.value();</span><br><span class="line">    						<span class="keyword">if</span> (mappedPatterns.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    							<span class="keyword">for</span> (String mappedPattern : mappedPatterns) &#123;</span><br><span class="line">    								<span class="keyword">if</span> (!hasTypeLevelMapping &amp;&amp; !mappedPattern.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">    									mappedPattern = <span class="string">"/"</span> + mappedPattern;</span><br><span class="line">    								&#125;</span><br><span class="line">    								addUrlsForPath(urls, mappedPattern);</span><br><span class="line">    							&#125;</span><br><span class="line">    						&#125;</span><br><span class="line">    						<span class="keyword">else</span> <span class="keyword">if</span> (hasTypeLevelMapping) &#123;</span><br><span class="line">    							urls.add(<span class="keyword">null</span>);</span><br><span class="line">    						&#125;</span><br><span class="line">    					&#125;</span><br><span class="line">    				&#125;</span><br><span class="line">    			&#125;, ReflectionUtils.USER_DECLARED_METHODS);</span><br><span class="line">    		&#125;</span><br><span class="line">    		<span class="keyword">return</span> StringUtils.toStringArray(urls);</span><br><span class="line">    	&#125;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    <span class="keyword">protected</span> String[] determineUrlsForHandlerMethods(Class&lt;?&gt; handlerType) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>BeanNameUrlHandlerMapping<br><br>BeanNameUrlHandlerMapping只有一个方法<font color="red">determineUrlsForHandler</font>，检查beanName和alias是不是以”/“开头，如果是就将其作为url。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanNameUrlHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractDetectingUrlHandlerMapping</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> String[] determineUrlsForHandler(String beanName) &#123;</span><br><span class="line">		List&lt;String&gt; urls = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		<span class="keyword">if</span> (beanName.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">			urls.add(beanName);</span><br><span class="line">		&#125;</span><br><span class="line">		String[] aliases = getApplicationContext().getAliases(beanName);</span><br><span class="line">		<span class="keyword">for</span> (String alias : aliases) &#123;</span><br><span class="line">			<span class="keyword">if</span> (alias.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">				urls.add(alias);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> StringUtils.toStringArray(urls);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>AbstractControllerUrlHandlerMapping<br><br>是将实现了<font color="red">Controller接口</font>或者<font color="red">添加@Controller注解</font>的bean作为Handler，并且可以通过设置<font color="red">excludedPackages</font>和<font color="red">excludedClasses</font>派出不必要的packages和classes。<font color="red">determineUrlsForHandler</font>方法的作用是将符合条件的Handler找出来，而具体用什么Url则交给模板方法<font color="red">buildUrlsForHandler</font>由子类去实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.mvc.support.AbstractControllerUrlHandlerMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractControllerUrlHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractDetectingUrlHandlerMapping</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ControllerTypePredicate predicate = <span class="keyword">new</span> AnnotationControllerTypePredicate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; excludedPackages = Collections.singleton(<span class="string">"org.springframework.web.servlet.mvc"</span>);</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Class&gt; excludedClasses = Collections.emptySet();</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] determineUrlsForHandler(String beanName) &#123;</span><br><span class="line">        Class beanClass = getApplicationContext().getType(beanName);</span><br><span class="line">        <span class="comment">//判断是否支持beanClass类型</span></span><br><span class="line">        <span class="keyword">if</span> (isEligibleForMapping(beanName, beanClass)) &#123;</span><br><span class="line">            <span class="comment">//模板方法，由子类实现</span></span><br><span class="line">            <span class="keyword">return</span> buildUrlsForHandler(beanName, beanClass);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isEligibleForMapping</span><span class="params">(String beanName, Class beanClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (beanClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//排除classes</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.excludedClasses.contains(beanClass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//排除package..</span></span><br><span class="line">        String beanClassName = beanClass.getName();</span><br><span class="line">        <span class="keyword">for</span> (String packageName : <span class="keyword">this</span>.excludedPackages) &#123;</span><br><span class="line">            <span class="keyword">if</span> (beanClassName.startsWith(packageName)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//判断beanClass是否为Controller子类或者 存在@Controller注解</span></span><br><span class="line">        <span class="keyword">return</span> isControllerType(beanClass);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>它有两个子类：<font color="red">ControllerBeanNameHandlerMapping和ControllerClassNameHandlerMapping</font>

<ol>
<li><font color="red">ControllerBeanNameHandlerMapping</font>: 将beanName和alias 当成url;</li>
<li><font color="red">ControllerClassNameHandlerMapping</font>: 将ClassName当成url;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ControllerClassNameHandlerMapping</span> <span class="keyword">extends</span> <span class="title">AbstractControllerUrlHandlerMapping</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果beanclass以"Controller" 则剔除此部分.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTROLLER_SUFFIX = <span class="string">"Controller"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> caseSensitive = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String pathPrefix;</span><br><span class="line">    <span class="keyword">private</span> String basePackage;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> StringBuilder <span class="title">buildPathPrefix</span><span class="params">(Class beanClass)</span> </span>&#123;</span><br><span class="line">        StringBuilder pathMapping = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.pathPrefix != <span class="keyword">null</span>) &#123;</span><br><span class="line">            pathMapping.append(<span class="keyword">this</span>.pathPrefix);</span><br><span class="line">            pathMapping.append(<span class="string">"/"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             pathMapping.append(<span class="string">"/"</span>);</span><br><span class="line">         &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//如果配置了basepackage,则subPackage转换为path...</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.basePackage != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String packageName = ClassUtils.getPackageName(beanClass);</span><br><span class="line">            <span class="keyword">if</span> (packageName.startsWith(<span class="keyword">this</span>.basePackage)) &#123;</span><br><span class="line">                String subPackage = packageName.substring(<span class="keyword">this</span>.basePackage.length()).replace(<span class="string">'.'</span>, <span class="string">'/'</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//判断是否大小写敏感</span></span><br><span class="line">                pathMapping.append(<span class="keyword">this</span>.caseSensitive ? subPackage : subPackage.toLowerCase());</span><br><span class="line">                pathMapping.append(<span class="string">"/"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pathMapping;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://linfordhu.github.io/lfhboke.github.io/2017/04/30/springmvc组件之HandlerMapping/" data-id="cisq5qad9000itsudviictrjw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/lfhboke.github.io/2017/06/17/activeMq基础应用/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          消息中间件之ActiveMq（基础篇）
        
      </div>
    </a>
  
  
    <a href="/lfhboke.github.io/2017/04/01/Mybatis（插件）/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Mybatis（插件）</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/lfhboke.github.io/archives/2016/01/">January 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/lfhboke.github.io/2019/05/22/redis之LRU算法/">redis之LRU算法</a>
          </li>
        
          <li>
            <a href="/lfhboke.github.io/2019/05/22/java8新特性/">java8新特性</a>
          </li>
        
          <li>
            <a href="/lfhboke.github.io/2019/03/01/流计算框架之storm（基础篇）/">流计算框架之storm（基础篇）</a>
          </li>
        
          <li>
            <a href="/lfhboke.github.io/2018/10/13/消息中间件之kafka-原理篇/">消息中间件之kafka(原理篇)</a>
          </li>
        
          <li>
            <a href="/lfhboke.github.io/2018/10/13/消息中间件之kafka-基础篇/">消息中间件之kafka(基础篇)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 lfhu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/lfhboke.github.io/" class="mobile-nav-link">Home</a>
  
    <a href="/lfhboke.github.io/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/lfhboke.github.io/fancybox/jquery.fancybox.css">
  <script src="/lfhboke.github.io/fancybox/jquery.fancybox.pack.js"></script>


<script src="/lfhboke.github.io/js/script.js"></script>



  </div>
</body>
</html>